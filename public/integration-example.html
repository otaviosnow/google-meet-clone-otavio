<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo de Integração - CallX</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .highlight {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
        }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background: #0056b3;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🔗 Exemplo de Integração CallX</h1>
    
    <div class="highlight">
        <strong>Como integrar o CallX em suas páginas da Hostgator/Elementor:</strong>
        <p>Este exemplo mostra como adicionar um botão que cria reuniões automaticamente.</p>
    </div>

    <h2>1. Configuração Básica</h2>
    <p>Primeiro, configure seu token de integração no painel CallX e obtenha o token.</p>

    <h2>2. Código JavaScript</h2>
    <p>Adicione este código no seu site (via Elementor HTML widget ou no código da página):</p>

    <div class="code-block">
<pre><code>&lt;script&gt;
// Configuração da integração CallX
const CALLX_CONFIG = {
    apiUrl: 'https://seu-dominio-callx.com/api/integration',
    token: 'SEU_TOKEN_AQUI', // Substitua pelo seu token
    defaultVideoId: null // ID do vídeo padrão (opcional)
};

// Função para criar reunião
async function createCallXMeeting(videoId = null, title = null, redirectUrl = null) {
    try {
        const response = await fetch(`${CALLX_CONFIG.apiUrl}/create-meeting`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                token: CALLX_CONFIG.token,
                videoId: videoId || CALLX_CONFIG.defaultVideoId,
                title: title || 'Reunião via Site',
                redirectUrl: redirectUrl || window.location.href,
                customerInfo: {
                    source: window.location.href,
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString()
                }
            })
        });

        const result = await response.json();

        if (response.ok) {
            // Sucesso - redirecionar para a reunião
            if (result.redirectUrl) {
                window.location.href = result.redirectUrl;
            } else {
                window.open(result.meetLink, '_blank');
            }
        } else {
            // Erro
            console.error('Erro ao criar reunião:', result.error);
            alert('Erro ao criar reunião: ' + result.error);
        }
    } catch (error) {
        console.error('Erro na requisição:', error);
        alert('Erro ao conectar com o CallX');
    }
}

// Função para listar vídeos disponíveis
async function loadCallXVideos() {
    try {
        const response = await fetch(`${CALLX_CONFIG.apiUrl}/tokens/${CALLX_CONFIG.token}/videos`);
        const result = await response.json();
        
        if (response.ok) {
            return result.videos;
        } else {
            console.error('Erro ao carregar vídeos:', result.error);
            return [];
        }
    } catch (error) {
        console.error('Erro ao carregar vídeos:', error);
        return [];
    }
}

// Função para criar botão dinâmico
async function createCallXButton(containerId, buttonText = 'Iniciar Reunião') {
    const container = document.getElementById(containerId);
    if (!container) return;

    // Carregar vídeos disponíveis
    const videos = await loadCallXVideos();
    
    if (videos.length === 0) {
        container.innerHTML = '&lt;p&gt;Nenhum vídeo configurado&lt;/p&gt;';
        return;
    }

    // Se há apenas um vídeo, criar botão simples
    if (videos.length === 1) {
        const button = document.createElement('button');
        button.textContent = buttonText;
        button.className = 'callx-button';
        button.onclick = () => createCallXMeeting(videos[0].id);
        container.appendChild(button);
        return;
    }

    // Se há múltiplos vídeos, criar dropdown
    const select = document.createElement('select');
    select.className = 'callx-video-select';
    
    videos.forEach(video => {
        const option = document.createElement('option');
        option.value = video.id;
        option.textContent = video.name;
        select.appendChild(option);
    });

    const button = document.createElement('button');
    button.textContent = buttonText;
    button.className = 'callx-button';
    button.onclick = () => createCallXMeeting(select.value);

    container.appendChild(select);
    container.appendChild(button);
}
&lt;/script&gt;</code></pre>
    </div>

    <h2>3. Exemplos de Uso</h2>

    <h3>Botão Simples</h3>
    <div class="code-block">
<pre><code>&lt;!-- HTML --&gt;
&lt;div id="callx-button-container"&gt;&lt;/div&gt;

&lt;script&gt;
// Criar botão quando a página carregar
document.addEventListener('DOMContentLoaded', () => {
    createCallXButton('callx-button-container', 'Iniciar Reunião');
});
&lt;/script&gt;</code></pre>
    </div>

    <h3>Botão com Vídeo Específico</h3>
    <div class="code-block">
<pre><code>&lt;button onclick="createCallXMeeting('VIDEO_ID_AQUI', 'Reunião Personalizada')"&gt;
    Iniciar Reunião Específica
&lt;/button&gt;</code></pre>
    </div>

    <h3>Integração com Formulário</h3>
    <div class="code-block">
<pre><code>&lt;form onsubmit="handleFormSubmit(event)"&gt;
    &lt;input type="text" id="customerName" placeholder="Seu nome" required&gt;
    &lt;input type="email" id="customerEmail" placeholder="Seu email" required&gt;
    &lt;button type="submit"&gt;Agendar Reunião&lt;/button&gt;
&lt;/form&gt;

&lt;script&gt;
async function handleFormSubmit(event) {
    event.preventDefault();
    
    const name = document.getElementById('customerName').value;
    const email = document.getElementById('customerEmail').value;
    
    // Criar reunião com informações do cliente
    await createCallXMeeting(
        null, // vídeo padrão
        `Reunião com ${name}`,
        `${window.location.origin}/obrigado?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`
    );
}
&lt;/script&gt;</code></pre>
    </div>

    <h2>4. Configuração no Elementor</h2>
    <ol>
        <li>Crie um widget HTML no Elementor</li>
        <li>Cole o código JavaScript na seção "Código HTML"</li>
        <li>Adicione um div com ID para o botão</li>
        <li>Configure o token no código</li>
    </ol>

    <h2>5. Exemplo Completo para Elementor</h2>
    <div class="code-block">
<pre><code>&lt;div style="text-align: center; padding: 40px;"&gt;
    &lt;h2&gt;Agende sua Reunião&lt;/h2&gt;
    &lt;p&gt;Clique no botão abaixo para iniciar uma reunião personalizada&lt;/p&gt;
    &lt;div id="callx-integration"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
// Configuração
const CALLX_CONFIG = {
    apiUrl: 'https://seu-dominio-callx.com/api/integration',
    token: 'SEU_TOKEN_AQUI'
};

// Função simplificada
async function createCallXMeeting() {
    try {
        const response = await fetch(`${CALLX_CONFIG.apiUrl}/create-meeting`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                token: CALLX_CONFIG.token,
                title: 'Reunião via Site',
                redirectUrl: window.location.href
            })
        });

        const result = await response.json();
        
        if (response.ok) {
            window.open(result.meetLink, '_blank');
        } else {
            alert('Erro: ' + result.error);
        }
    } catch (error) {
        alert('Erro ao conectar com o CallX');
    }
}

// Criar botão
document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('callx-integration');
    if (container) {
        const button = document.createElement('button');
        button.textContent = '🚀 Iniciar Reunião';
        button.style.cssText = `
            background: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        `;
        button.onmouseover = () => button.style.background = '#0056b3';
        button.onmouseout = () => button.style.background = '#007bff';
        button.onclick = createCallXMeeting;
        
        container.appendChild(button);
    }
});
&lt;/script&gt;</code></pre>
    </div>

    <h2>6. Teste da Integração</h2>
    <p>Clique no botão abaixo para testar a integração:</p>
    
    <div id="test-integration">
        <button class="button" onclick="testIntegration()">🧪 Testar Integração</button>
    </div>
    
    <div id="test-result"></div>

    <script>
        // Configuração de teste
        const CALLX_CONFIG = {
            apiUrl: window.location.origin + '/api/integration',
            token: 'test-token' // Token de teste
        };

        async function testIntegration() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div class="highlight">Testando integração...</div>';

            try {
                const response = await fetch(`${CALLX_CONFIG.apiUrl}/create-meeting`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        token: CALLX_CONFIG.token,
                        title: 'Teste de Integração',
                        redirectUrl: window.location.href
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ✅ Integração funcionando!<br>
                            Meeting ID: ${result.meetingId}<br>
                            <a href="${result.meetLink}" target="_blank">Abrir Reunião</a>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            ❌ Erro: ${result.error}<br>
                            Status: ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ❌ Erro de conexão: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
